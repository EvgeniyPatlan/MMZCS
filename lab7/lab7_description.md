**Лабораторна робота №7: Реалізація захищеної передачі даних по протоколу TLS засобами криптографічного пакету OpenSSL**

**Мета:** Ознайомитися зі способами організації захищених TLS-з'єднань засобами криптографічного пакету OpenSSL, а також отримати навички у створенні найпростіших клієнтських і серверних додатків у середовищі Linux.

**Теоретичні відомості**

Протокол TLS (Transport Layer Security) є сучасним стандартом для забезпечення безпеки передавання даних. TLS забезпечує шифрування даних, автентифікацію сторін і цілісність повідомлень, що робить його важливим для захисту конфіденційної інформації. У цій роботі реалізовано TLS-з'єднання з односторонньою автентифікацією сервера.

**Сертифікати та OpenSSL**  
- **CA-сертифікат**: Центр сертифікації (CA) генерує та підписує сертифікати, які виступають гарантією автентичності.
- **Сертифікати користувачів**: Для створення TLS-з'єднання використовуються сертифікати, підписані CA, що забезпечують перевірку автентичності учасників обміну даними.

**Опис реалізації**

1. **Генерація сертифікатів**:
   - Створено ключову пару RSA (2048 біт) і самопідписаний сертифікат для CA за допомогою OpenSSL.
   - Згенеровано дві ключові пари для користувачів (клієнта і сервера), сертифікати яких підписані CA і збережені у форматі PKCS#12.
   - Скрипт `generate_certs.sh` генерує необхідні сертифікати для сервера та користувачів.

2. **Розробка клієнтського і серверного додатків**:
   - Розроблено консольні додатки на C із використанням OpenSSL для організації TLS-з'єднання.
   - **Серверний додаток (`tls_server_minimal.c`)**: Створює TLS-контекст, слухає вхідні підключення за допомогою TCP-сокета, приймає з'єднання від клієнта і встановлює TLS-сесію для захищеної передачі даних.
   - **Клієнтський додаток (`tls_client_minimal.c`)**: Створює TLS-контекст, підключається до сервера через TLS і надсилає повідомлення.

**Як працює програма**

1. **Генерація сертифікатів**:
   - Виконайте скрипт `generate_certs.sh` для створення необхідних сертифікатів (CA, клієнта, сервера). 
   - Генерація виконується шляхом створення RSA ключів для сервера та користувачів, а також підписання їх CA.
   - Додатково, сертифікати зберігаються у форматі PKCS#12 за допомогою скрипту `generate_pkcs12.sh`.

2. **Налаштування середовища**:
   - Переконайтеся, що встановлено необхідні бібліотеки для OpenSSL (`libssl-dev`) і компілятор GCC.
   - Ініціалізовано бібліотеку OpenSSL викликом `SSL_library_init()` та налаштовано контекст TLS за допомогою `SSL_CTX_new()` і `SSL_CTX_set_mode()`.

3. **Встановлення TLS-з'єднання**:
   - **Серверний додаток**: Створює TLS-контекст, встановлює сертифікат і приватний ключ, слухає вхідні підключення за допомогою TCP-сокета та ініціює TLS-з'єднання після прийняття підключення.
   - **Клієнтський додаток**: Створює TLS-контекст, встановлює довірчий сертифікат CA, підключається до сервера та ініціює TLS Handshake для встановлення захищеного з'єднання.

4. **Обмін повідомленнями**:
   - Після успішного завершення TLS Handshake клієнт надсилає серверу текстове повідомлення, яке сервер повертає назад для підтвердження.
   - Повідомлення передаються із використанням функцій `SSL_write()` та `SSL_read()`.

5. **Завершення з'єднання**:
   - Після обміну даними TLS-з'єднання закривається за допомогою `SSL_shutdown()`, після чого закриваються TCP-з'єднання і звільняються ресурси.

**Як зібрати та запустити програму**

1. **Генерація сертифікатів**:
   - Переконайтеся, що OpenSSL встановлено (`sudo apt-get install openssl`).
   - Виконайте скрипт `generate_certs.sh` для створення необхідних сертифікатів (CA, клієнта, сервера).

2. **Збірка програми**:
   - Використайте GCC для компіляції серверного і клієнтського додатків:
     ```
     gcc -o tls_server tls_server_minimal.c -lssl -lcrypto
     gcc -o tls_client tls_client_minimal.c -lssl -lcrypto
     ```

3. **Запуск програми**:
   - Спочатку запустіть серверний додаток, який слухає вказаний порт:
     ```
     ./tls_server
     ```
   - Потім запустіть клієнтський додаток і введіть IP-адресу сервера для встановлення з'єднання:
     ```
     ./tls_client
     ```

**Запуск тестів**

1. **Тестування генерації сертифікатів**:
   - Запустіть `./generate_certs.sh` для генерації сертифікатів для CA та користувачів.
   - Перевірте наявність очікуваних файлів сертифікатів (`serv_cert.pem`, `user1_cert.pem`, `user2_cert.pem`).

2. **Запуск тестового сценарію (`run_tests.sh`)**:
   - Сценарій спочатку генерує сертифікати, запускає серверний додаток у фоновому режимі, потім запускає клієнтський додаток і порівнює вихідні дані з очікуваними.
   - Очікуваний результат: `"Received: Hello from client!"`.

**Результати тестування**

Було проведено тестування встановлення TLS-з'єднання між клієнтом і сервером. Клієнт успішно підключився до сервера, відправив текстове повідомлення, яке сервер повернув назад для підтвердження. TLS-з'єднання було встановлено успішно, а повідомлення передано без помилок.

**Висновки**

Ця лабораторна робота дозволила ознайомитися з протоколом TLS та його реалізацією засобами OpenSSL. Було створено сертифікати для забезпечення автентифікації та розроблено додатки для встановлення захищених з'єднань. Реалізація клієнт-серверної моделі показала, як забезпечити безпеку передачі даних у мережах за допомогою TLS і OpenSSL.


### Огляд алгоритму та його реалізації

Алгоритм шифрування **ДСТУ ГОСТ 28147:2009** є українським стандартом блокового шифрування даних і працює на основі мережі **Фейстеля**. Алгоритм використовує ключ довжиною 256 біт і розмір блоку даних 64 біти (8 байт). Він включає в себе 32 раунди шифрування з використанням підключів, обчислюваних на основі основного ключа.

Алгоритм підтримує кілька режимів шифрування:
1. **ECB (Electronic Codebook Mode)** – режим простої заміни.
2. **OFB (Output Feedback Mode)** – режим гамування.
3. **CFB (Cipher Feedback Mode)** – режим гамування зі зворотним зв'язком.

#### Основна ідея мережі Фейстеля:
Мережа Фейстеля розділяє кожен 64-бітний блок даних на дві частини — ліву і праву половини. В кожному раунді алгоритм застосовує функцію шифрування до правої половини і результат використовує для модифікації лівої половини. Після кожного раунду ці дві половини міняються місцями.

Основна формула мережі Фейстеля:
- Права половина блоку змінюється на ліву половину попереднього блоку.
- Ліва половина нового блоку змінюється через XOR результату функції шифрування правої половини і підключа.

### Опис алгоритму шифрування (ДСТУ ГОСТ 28147:2009):

1. **Вхідні дані**: 
   - **64-бітний блок даних** (розмір блоку: 8 байт).
   - **256-бітний ключ** (розмір ключа: 32 байти).
   
2. **Підключі**:
   - Основний ключ розбивається на вісім 32-бітних підключів.
   - Підключі використовуються у порядку: \( K_0, K_1, K_2, \ldots, K_7 \), а потім цей порядок повторюється протягом 32 раундів.

3. **Функція раунду**:
   - У кожному раунді права половина блоку змінюється через функцію шифрування:
     1. Додаємо підключ (модуль 2^32).
     2. Підстановка через таблицю **S-блоків**.
     3. Циклічний зсув результату на 11 бітів.

4. **S-блоки**:
   - Після додавання підключа, результат розбивається на 8 частин по 4 біти.
   - Кожен 4-бітовий фрагмент замінюється на основі таблиці S-блоків, яка містить перестановку значень від 0 до 15.

5. **Циклічний зсув**:
   - Результат підстановки через S-блоки зсувається на 11 бітів вліво.

6. **Мережа Фейстеля**:
   - Після функції раунду виконується операція XOR з лівою половиною блоку.
   - Ліва половина блоку стає правою половиною для наступного раунду, і навпаки.

7. **Дешифрування**:
   - Процес дешифрування такий самий, але підключі використовуються в зворотному порядку.

### Опис роботи основних режимів:

#### 1. **ECB (Electronic Codebook Mode)**:
   - У цьому режимі кожен 64-бітний блок шифрується незалежно.
   - Недолік: однакові блоки даних шифруються в однакові блоки шифртексту, що може стати вразливістю.

#### 2. **OFB (Output Feedback Mode)**:
   - У режимі OFB псевдовипадкова гамма генерується на основі вектора ініціалізації (IV). Кожен наступний блок гами генерується шифруванням попереднього блоку.
   - Гамма XOR-иться з відкритим текстом, щоб отримати шифртекст.
   - Цей режим дозволяє шифрувати блоки даних, розмір яких може бути меншим за 64 біти.

#### 3. **CFB (Cipher Feedback Mode)**:
   - У режимі CFB використовується зворотний зв'язок. Для шифрування кожного наступного блоку використовується результат шифрування попереднього блоку.
   - Шифртекст кожного блоку залежить від результатів шифрування попередніх блоків, що забезпечує стійкість до атак на основі однакових блоків даних.

### Опис модулів та скриптів

#### 1. **Модуль `GOST_Encryption.pm`**:

Цей модуль реалізує функції шифрування та дешифрування на основі алгоритму ДСТУ ГОСТ 28147:2009. Основні функції включають:

- `encrypt_block`: Шифрує 64-бітний блок даних, виконуючи 32 раунди мережі Фейстеля.
- `decrypt_block`: Дешифрує 64-бітний блок даних, виконуючи ті ж 32 раунди у зворотному порядку.
- `ecb_mode`: Реалізує режим простої заміни (ECB), шифруючи кожен блок незалежно.
- `ofb_mode`: Реалізує режим гамування (OFB), використовуючи гамму на основі шифрування вектора ініціалізації.
- `cfb_mode`: Реалізує режим гамування зі зворотним зв'язком (CFB), використовуючи шифрування попереднього блоку для зворотного зв'язку.

#### 2. **Основний скрипт `main.pl`**:

Цей скрипт взаємодіє з користувачем, запитуючи параметри для шифрування або дешифрування (вхідний файл, вихідний файл, ключ, вектор ініціалізації, режим). Після цього він:
- Читає дані з вхідного файлу.
- Генерує підключі з ключа.
- Викликає відповідні функції з модуля для шифрування/дешифрування залежно від обраного режиму.
- Записує результат у вихідний файл.

#### 3. **Тестовий файл `test_gost.pl`**:

Цей скрипт використовує `Test::More` для написання тестів і перевірки функціональності шифрування та дешифрування в різних режимах. Він:
- Перевіряє, що шифрування змінює текст (тобто шифр відрізняється від відкритого тексту).
- Перевіряє, що дешифрування повертає початковий текст.

### Приклад:

Ось приклад роботи програми. При запуску скрипта `main.pl` програма запитає необхідні параметри:

```
Enter the input file name: input.txt
Enter the output file name: output.txt
Enter the key (64-byte in hexadecimal format): 0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF
Enter the initialization vector (IV) (16-byte in hexadecimal format): 1234567890ABCDEF
Choose operation mode (encrypt/decrypt): encrypt
Choose encryption mode (ECB/OFB/CFB): ECB
Operation completed successfully!
```

Після введення цих параметрів:
- Програма зчитує дані з файлу `input.txt`.
- Виконує шифрування в режимі ECB з використанням ключа та вектора ініціалізації.
- Записує зашифрований текст у файл `output.txt`.

### Підсумок:
- **ДСТУ ГОСТ 28147:2009** — це блоковий алгоритм шифрування на основі мережі Фейстеля.
- Програма підтримує три основні режими шифрування: ECB, OFB, CFB.
- Модуль `GOST_Encryption.pm` містить реалізацію алгоритму та функції для різних режимів.
- Скрипт `main.pl` взаємодіє з користувачем і виконує шифрування/дешифрування на основі введених параметрів.
- Тестовий скрипт перевіряє правильність роботи алгоритму в різних режимах.

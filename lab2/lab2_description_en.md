### Overview of the Algorithm and Its Implementation

The **DSTU GOST 28147:2009** encryption algorithm is a Ukrainian standard for block encryption. It operates based on the **Feistel network** and uses a 256-bit key with a 64-bit block size (8 bytes). The algorithm consists of 32 encryption rounds using subkeys derived from the main key.

The algorithm supports several encryption modes:
1. **ECB (Electronic Codebook Mode)** – simple block substitution mode.
2. **OFB (Output Feedback Mode)** – output feedback mode.
3. **CFB (Cipher Feedback Mode)** – cipher feedback mode.

#### Main Idea of the Feistel Network:
The Feistel network splits each 64-bit block of data into two halves — left and right. In each round, the algorithm applies an encryption function to the right half and uses the result to modify the left half. After each round, these two halves are swapped.

The basic formula of the Feistel network:
- The right half of the block becomes the left half of the next block.
- The new left half is modified using XOR with the result of the encryption function applied to the right half and the subkey.

### Encryption Algorithm Description (DSTU GOST 28147:2009):

1. **Input Data**: 
   - **64-bit data block** (block size: 8 bytes).
   - **256-bit key** (key size: 32 bytes).
   
2. **Subkeys**:
   - The main key is divided into eight 32-bit subkeys.
   - The subkeys are used in the order: \( K_0, K_1, K_2, \ldots, K_7 \), and then this sequence is repeated over 32 rounds.

3. **Round Function**:
   - In each round, the right half of the block is modified through the round function:
     1. Add the subkey (modulo \(2^{32}\)).
     2. Perform substitution using **S-boxes**.
     3. Perform a cyclic shift of the result by 11 bits.

4. **S-boxes**:
   - After adding the subkey, the result is divided into 8 parts of 4 bits each.
   - Each 4-bit fragment is substituted using an S-box, which contains a permutation of values from 0 to 15.

5. **Cyclic Shift**:
   - The result of the substitution is shifted 11 bits to the left.

6. **Feistel Network**:
   - After the round function, XOR is performed with the left half of the block.
   - The left half becomes the right half for the next round, and vice versa.

7. **Decryption**:
   - The decryption process is identical to encryption, but the subkeys are used in reverse order.

### Description of the Main Modes:

#### 1. **ECB (Electronic Codebook Mode)**:
   - In this mode, each 64-bit block is encrypted independently.
   - Drawback: identical blocks of plaintext result in identical ciphertext blocks, which can be a vulnerability.

#### 2. **OFB (Output Feedback Mode)**:
   - In OFB mode, a pseudorandom gamma is generated based on the initialization vector (IV). Each subsequent gamma block is generated by encrypting the previous one.
   - The gamma is XORed with the plaintext to produce the ciphertext.
   - This mode allows the encryption of data blocks smaller than 64 bits.

#### 3. **CFB (Cipher Feedback Mode)**:
   - In CFB mode, feedback is used. Each subsequent block is encrypted based on the result of the encryption of the previous block.
   - The ciphertext of each block depends on the results of encrypting the previous blocks, providing resistance to attacks on identical plaintext blocks.

### Module and Script Descriptions

#### 1. **Module `GOST_Encryption.pm`**:

This module implements the encryption and decryption functions based on the DSTU GOST 28147:2009 algorithm. The main functions include:

- `encrypt_block`: Encrypts a 64-bit block of data by performing 32 rounds of the Feistel network.
- `decrypt_block`: Decrypts a 64-bit block of data by performing the same 32 rounds in reverse order.
- `ecb_mode`: Implements the simple substitution mode (ECB), encrypting each block independently.
- `ofb_mode`: Implements output feedback mode (OFB), using gamma based on the encryption of the initialization vector (IV).
- `cfb_mode`: Implements cipher feedback mode (CFB), using the encryption of the previous block for feedback.

#### 2. **Main Script `main.pl`**:

This script interacts with the user, asking for parameters for encryption or decryption (input file, output file, key, initialization vector, mode). After this:
- It reads the data from the input file.
- Generates subkeys from the key.
- Calls the appropriate functions from the module for encryption/decryption based on the chosen mode.
- Writes the result to the output file.

#### 3. **Test Script `test_gost.pl`**:

This script uses `Test::More` to write tests and verify the encryption and decryption functionality in different modes. It:
- Checks that encryption alters the text (i.e., the ciphertext is different from the plaintext).
- Verifies that decryption returns the original text.

### Example:

Here is an example of the program's execution. When running the `main.pl` script, the program will prompt the user for the required parameters:

```
Enter the input file name: input.txt
Enter the output file name: output.txt
Enter the key (64-byte in hexadecimal format): 0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF
Enter the initialization vector (IV) (16-byte in hexadecimal format): 1234567890ABCDEF
Choose operation mode (encrypt/decrypt): encrypt
Choose encryption mode (ECB/OFB/CFB): ECB
Operation completed successfully!
```

After entering these parameters:
- The program reads the data from the file `input.txt`.
- It performs encryption in ECB mode using the specified key and initialization vector.
- The encrypted text is written to the file `output.txt`.

### Summary:
- **DSTU GOST 28147:2009** is a block encryption algorithm based on the Feistel network.
- The program supports three main encryption modes: ECB, OFB, and CFB.
- The module `GOST_Encryption.pm` contains the algorithm implementation and functions for different modes.
- The `main.pl` script interacts with the user and performs encryption or decryption based on the provided parameters.
- The test script verifies the correctness of the algorithm's operation in different modes.
